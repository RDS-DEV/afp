<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Result">

    <resultMap agencyId="agencyResult" type="agency">
        <agencyId property="agencyId" column="agencyId" />
        <result property="agencyName" column="agencyName" />
        <collection property="employees" javaType="ArrayList" column="agencyId" ofType="Employee" select="selectEmployeesForAgency"/>
    </resultMap>

    <select agencyId="selectAgencyResult" resultMap="agencyResult">
        SELECT agencyId, agencyName, agencyLocation FROM agency WHERE ID = #{agencyId}
    </select>

    <select agencyId="selectEmployeesForAgency" resultType="employee">
        SELECT emp_id as agencyId, emp_name as agencyName, agency_id as agencyId FROM employee WHERE agency_id = #{agencyId}
    </select>

    <resultMap agencyId="allAgenciesResult" type="agency">
        <agencyId property="agencyId" column="agencyId" />
        <!--<result property="agencyName" column="agencyName" />-->
        <collection property="employees" javaType="ArrayList" column="agencyId" ofType="Employee" select="selectEmployeesForAgency"/>
    </resultMap>

    <select agencyId="selectAllAgenciesResult" resultMap="agencyResult">
        SELECT agencyId, agencyName, agencyLocation FROM agency
    </select>


    <resultMap agencyId="allAgenciesJoinResult" type="Agency">
        <agencyId property="agencyId" column="agency_id" />
        <result property="agencyName" column="agency_name"/>
        <result property="agencyLocation" column="agencyLocation"/>
        <collection property="employees" ofType="Employee">
            <agencyId property="agencyId" column="emp_id"/>
            <result property="agencyName" column="emp_name"/>
            <result property="agencyId" column="agencyId"/>
        </collection>
    </resultMap>

    <select agencyId="selectAllAgenciesJoin" resultMap="allAgenciesJoinResult">
        select
        A.agencyId as agency_id,
        A.agencyName as agency_name,
        A.agencyLocation,
        E.emp_id as emp_id,
        E.emp_name as emp_name,
        E.agency_id as agencyId
        from Agency A
        left outer join Employee E on A.agencyId = E.agency_id
        order by A.agencyId
    </select>

    <!--
    <select agencyId="selectEmployeesForAgency" resultType="employee">
        SELECT emp_id as agencyId, emp_name as agencyName, agency_id as agencyId FROM employee WHERE agency_id = #{agencyId}
    </select>
    -->
</mapper>

